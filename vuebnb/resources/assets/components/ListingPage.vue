<template>
	<div>
		<div class="header">
    	<header-image 
    		v-if="listing.images[0]" 
    		:image-url="listing.images[0]" 
    		@header-clicked="openModal"
    		:id="listing.id">
    	</header-image>
  	</div>
  	<div class="listing-container">
    	<div class="heading">
      	<h1>{{ listing.title }}</h1>
      	<p>{{ listing.address }}</p>
    	</div>
    	<hr>
    	<div class="about">
      	<h3>About this listing</h3>
      	<expandable-text>{{ listing.about }}</expandable-text>
    	</div>
    	<div class="lists">
      	<feature-list title="Amenities" :items="listing.amenities">
        	<template slot-scope="amenity">
          	<i class="fa fa-lg" :class="amenity.icon"></i>
          	<span>{{ amenity.title }}</span>
        	</template>
      	</feature-list>
      	<feature-list title="Prices" :items="listing.prices">
        	<template slot-scope="price">
          	{{ price.title }}: <strong>{{ price.value }}</strong>
        	</template>
      	</feature-list>
    	</div>
  	</div>
  	<modal-window ref="imagemodal">
    	<image-carousel :images="listing.images"></image-carousel>
  	</modal-window>
	</div>
</template>

<script>
	import { populateAmenitiesAndPrices } from '../js/helpers';
	
	// components
	import HeaderImage from './HeaderImage.vue';
	import ImageCarousel from './ImageCarousel.vue';
	import ModalWindow from './ModalWindow.vue';
	import FeatureList from './FeatureList.vue';
	import ExpandableText from './ExpandableText.vue';

	export default {
		components: {
			ImageCarousel,
			ModalWindow,
			FeatureList,
			HeaderImage,
			ExpandableText
		},
		computed: {
			listing() {
				let listing = this.$store.state.listings.find(
					listing => listing.id == this.$route.params.listing
					);
				return populateAmenitiesAndPrices(listing);
			}
		},
		methods: {
			openModal() {
				this.$refs.imagemodal.modalOpen = true;
			}
		}
	}
</script>
<style>
	.about {
		margin: 2em 0;
	}

	.about h3 {
		font-size: 22px;
	}
</style>